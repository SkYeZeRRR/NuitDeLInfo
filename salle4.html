<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Salle 4 â€” Recyclage numÃ©rique</title>

    <!-- Police arcade / pixel -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <!-- Feuille de style -->
    <link rel="stylesheet" href="../css/salle4.css">
</head>
<body>
<div class="game-wrapper">

    <!-- BOUTON RETOUR -->
    <a href="../map.html" class="back-btn">â† Retour Ã  la map</a>

    <div class="header">
        <h1>Salle 4 â€” Recyclage numÃ©rique & cycle de vie</h1>
        <h2>Mini-jeu : â€œRemets les Ã©tapes dans lâ€™ordreâ€ â™»ï¸</h2>
        <p>Du dÃ©but Ã  la fin : place les Ã©tapes du cycle de vie dans le bon ordre.</p>
    </div>

    <div class="layout">

        <!-- Panneau principal -->
        <div class="main-panel">
            <h3 class="panel-title">Ordre du cycle de vie</h3>
            <p class="panel-subtitle">
                Glisse chaque Ã©tiquette pour reconstituer le cycle complet dâ€™un Ã©quipement numÃ©rique.
            </p>

            <ul id="steps-list" class="steps-list">
                <!-- On met volontairement dans le dÃ©sordre -->
                <li class="step" draggable="true" data-step="Transport">Transport</li>
                <li class="step" draggable="true" data-step="Fin de vie / Recyclage">Fin de vie / Recyclage</li>
                <li class="step" draggable="true" data-step="Extraction">Extraction</li>
                <li class="step" draggable="true" data-step="Usage">Usage</li>
                <li class="step" draggable="true" data-step="Fabrication">Fabrication</li>
            </ul>
        </div>

        <!-- Panneau dâ€™explications -->
        <aside class="side-panel">
            <h4>Cycle de vie dâ€™un appareil ğŸŒ</h4>
            <p class="side-text">
                Chaque smartphone, PC ou tablette passe par plusieurs grandes Ã©tapes qui ont toutes un impact
                environnemental : consommation dâ€™Ã©nergie, de mÃ©taux, transport, dÃ©chetsâ€¦
            </p>
            <ul class="info-list">
                <li><strong>Extraction</strong> : mÃ©taux rares, minerais, pÃ©troleâ€¦</li>
                <li><strong>Fabrication</strong> : usines, assemblage, forte consommation dâ€™Ã©nergie.</li>
                <li><strong>Transport</strong> : bateaux, camions, avions.</li>
                <li><strong>Usage</strong> : Ã©lectricitÃ©, rÃ©seau, rÃ©parations possibles.</li>
                <li><strong>Fin de vie / Recyclage</strong> : tri, rÃ©emploi, recyclage des matÃ©riaux.</li>
            </ul>
            <p class="side-tip">
                <span>ğŸ’¡</span> Moins on renouvelle vite nos appareils, plus on rÃ©duit lâ€™impact des Ã©tapes les plus lourdes
                (extraction & fabrication).
            </p>
        </aside>
    </div>

    <div class="controls">
        <button id="check-btn" class="btn-primary">âœ” VÃ©rifier</button>
        <button id="reset-btn" class="btn-secondary">ğŸ” Reset</button>

        <!-- BOUTON SUIVANT (cachÃ© au dÃ©but) -->
        <button id="next-btn" class="btn-next" style="display:none;">
            Suivant â†’ Salle 5
        </button>

        <div id="feedback" class="feedback">
            Remets les Ã©tapes dans lâ€™ordre : de lâ€™extraction jusquâ€™Ã  la fin de vie / recyclage.
        </div>
    </div>
</div>

<script>
    const stepsList = document.getElementById('steps-list');
    const steps = Array.from(stepsList.querySelectorAll('.step'));

    const checkBtn = document.getElementById('check-btn');
    const resetBtn = document.getElementById('reset-btn');
    const nextBtn = document.getElementById('next-btn');
    const feedback = document.getElementById('feedback');

    // Ordre correct attendu
    const correctOrder = [
        "Extraction",
        "Fabrication",
        "Transport",
        "Usage",
        "Fin de vie / Recyclage"
    ];

    // Sauvegarde de lâ€™ordre initial (pour reset)
    const initialOrder = steps.map(li => li.dataset.step);

    let draggedStep = null;

    // Drag & drop pour rÃ©ordonner la liste
    steps.forEach(step => {
        step.addEventListener('dragstart', () => {
            draggedStep = step;
            step.classList.add('dragging');
        });

        step.addEventListener('dragend', () => {
            draggedStep = null;
            step.classList.remove('dragging');
        });

        step.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        step.addEventListener('drop', (e) => {
            e.preventDefault();
            if (!draggedStep || draggedStep === step) return;

            const children = Array.from(stepsList.children);
            const draggedIndex = children.indexOf(draggedStep);
            const targetIndex = children.indexOf(step);

            if (draggedIndex < targetIndex) {
                stepsList.insertBefore(draggedStep, step.nextSibling);
            } else {
                stepsList.insertBefore(draggedStep, step);
            }

            clearHighlights();
        });
    });

    function clearHighlights() {
        const allSteps = stepsList.querySelectorAll('.step');
        allSteps.forEach(li => {
            li.classList.remove('step-correct', 'step-wrong');
        });
        feedback.className = 'feedback';
    }

    // VÃ©rifier lâ€™ordre
    checkBtn.addEventListener('click', () => {
        clearHighlights();
        const currentSteps = Array.from(stepsList.querySelectorAll('.step'));
        const currentOrder = currentSteps.map(li => li.dataset.step);

        let correctCount = 0;

        currentSteps.forEach((li, index) => {
            if (currentOrder[index] === correctOrder[index]) {
                li.classList.add('step-correct');
                correctCount++;
            } else {
                li.classList.add('step-wrong');
            }
        });

        if (correctCount === correctOrder.length) {
            feedback.textContent = "Parfait ! Tu maÃ®trises le cycle de vie numÃ©rique â™»ï¸âœ¨";
            feedback.className = "feedback success";
            nextBtn.style.display = "inline-block"; // afficher le bouton suivant
        } else {
            feedback.textContent = `${correctCount}/${correctOrder.length} Ã©tapes sont au bon endroit. Ajuste encore lâ€™ordre.`;
            feedback.className = "feedback error";
            nextBtn.style.display = "none";
        }
    });

    // Reset : remettre dans lâ€™ordre initial (dÃ©sordre de dÃ©part)
    resetBtn.addEventListener('click', () => {
        const allSteps = Array.from(stepsList.querySelectorAll('.step'));
        stepsList.innerHTML = "";
        initialOrder.forEach(stepName => {
            const li = allSteps.find(el => el.dataset.step === stepName);
            if (li) {
                li.classList.remove('step-correct', 'step-wrong', 'dragging');
                stepsList.appendChild(li);
            }
        });

        feedback.textContent = "Remets les Ã©tapes dans lâ€™ordre : de lâ€™extraction jusquâ€™Ã  la fin de vie / recyclage.";
        feedback.className = "feedback";
        nextBtn.style.display = "none";
    });

    // Bouton suivant â†’ Salle 5
    nextBtn.addEventListener('click', () => {
        // Salle 4 est dans /salles/, salle5.html est dans le mÃªme dossier
        window.location.href = "salle5.html";
    });
</script>

</body>
</html>
