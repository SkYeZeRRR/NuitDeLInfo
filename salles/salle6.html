<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz N√©gociation üéØ : Ma√Ætrisez la D√©marche NIRN</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        /* --- CSS : DESIGN ARCADE (Palette Bleue Marine & Blanc) --- */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --bg-color: #1a2530;
            --card-color: var(--secondary-color);
            --text-color: #ffffff;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background-color: var(--bg-color);
            background-image: linear-gradient(135deg, var(--bg-color) 0%, #001f3f 100%);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            font-size: 10px;
        }

        .container {
            background: var(--card-color);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 0 0 5px var(--primary-color), 0 20px 40px rgba(0,0,0,0.5);
            width: 95%;
            max-width: 700px;
            text-align: center;
            position: relative;
            transition: transform 0.3s;
        }

        .screen {
            display: none;
            animation: fadeIn 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .screen.active {
            display: block;
        }

        h1, h2 {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.5rem;
        }

        /* Boutons */
        .btn {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            padding: 14px 35px;
            font-size: 0.8rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:hover {
            background-color: #7fbfec;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--text-color);
            color: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background-color: #ccc;
        }

        /* Quiz Header */
        .header-quiz {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .timer-box, .progress-box {
            font-weight: 700;
            padding: 5px 15px;
            border-radius: 10px;
            background: var(--bg-color);
            color: var(--primary-color);
            font-size: 0.6rem;
            border: 1px solid var(--primary-color);
        }

        .timer-box.critical {
            color: var(--error-color);
            animation: pulse 1s infinite;
        }

        .question-text {
            color: var(--text-color);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 30px;
        }

        .options-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            background-color: #1a2530;
            color: var(--text-color);
            border: 1px solid var(--primary-color);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            text-align: left;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #34495e;
            border-color: var(--primary-color);
            transform: translateX(5px);
        }

        .option-btn.correct {
            background-color: var(--success-color);
            color: var(--secondary-color);
            border-color: var(--success-color);
        }

        .option-btn.wrong {
            background-color: var(--error-color);
            color: var(--text-color);
            border-color: var(--error-color);
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 20px 0 10px;
        }

        .time-details {
            display: flex;
            justify-content: space-around;
            margin: 20px 0 30px;
            padding: 15px;
            background: #1a2530;
            border-radius: 10px;
        }

        .time-detail strong {
            display: block;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .feedback {
            font-size: 0.8rem;
            margin: 20px 0;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid var(--primary-color);
            background: #1a2530;
            color: var(--text-color);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--secondary-color);
            color: var(--text-color);
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
        }

        .review-item {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            background: #1a2530;
            border: 1px solid var(--primary-color);
        }

        .review-item h4 {
            margin-top: 0;
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        .review-item.correct-answer {
            background: #0d3222;
            border-left: 5px solid var(--success-color);
        }

        .review-item.wrong-answer {
            background: #440d0d;
            border-left: 5px solid var(--error-color);
        }

        .explanation-box {
            font-style: italic;
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #555;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.06); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

<div class="container">

    <div id="start-screen" class="screen active">
        <h1>üéØ Quiz N√©gociation</h1>
        <p style="color: var(--primary-color); font-weight: 600; text-transform: uppercase;">
            La D√©marche NIRN (N√©gociation, Information, Relation, N√©gociation)
        </p>
        <p>Testez vos connaissances sur les √©tapes cl√©s pour mener une n√©gociation efficace.</p>
        <div style="background: #1a2530; padding: 20px; border-radius: 10px; margin: 25px 0; text-align: left; border-left: 4px solid var(--primary-color);">
            üëâ 15 questions sur les √©tapes de Pr√©paration, Information, √âtablissement de la Relation et Conclusion.<br>
            üí° Rapport de correction d√©taill√© √† la fin, incluant le temps mis !
        </div>
        <button onclick="startQuiz()" class="btn">D√©marrer le Quiz NIRN</button>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="header-quiz">
            <div class="timer-box">
                ‚è±Ô∏è <span id="time">15</span> secondes
            </div>
            <div class="progress-box">
                Question <span id="current-question-num">1</span> / 15
            </div>
        </div>

        <div class="question-container">
            <div class="question-text" id="question-text">
                Chargement de la question...
            </div>
            <div id="options-container" class="options-grid">
            </div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h2>üèÜ Bilan de Comp√©tences !</h2>
        <p>Votre performance sur la d√©marche NIRN :</p>
        <div class="score-display">
            <span id="final-score">0</span> / 15
        </div>

        <div class="time-details">
            <div class="time-detail">
                <small>Temps Total</small>
                <strong id="total-time-display">0s</strong>
            </div>
            <div class="time-detail">
                <small>Temps Moyen par Question</small>
                <strong id="avg-time-display">0s</strong>
            </div>
        </div>

        <p id="feedback-text" class="feedback"></p>

        <button onclick="showReviewModal()" class="btn btn-secondary">Voir la Correction (Pourquoi ?)</button>
        <button onclick="restartQuiz()" class="btn">Rejouer</button>
        <!-- Bouton Terminer ‚Üí renvoie √† la map + marque tout comme termin√© -->
        <button id="finish-btn" class="btn btn-secondary" onclick="finishAndReturn()" style="display:none;">
            Terminer
        </button>
    </div>

</div>

<div id="review-modal" class="modal" onclick="closeReviewModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 style="color: var(--primary-color);">Rapport de Correction D√©taill√©</h2>
        <p>Analyse de vos r√©ponses et explications des concepts cl√©s de la n√©gociation.</p>
        <div id="review-content"></div>
        <button onclick="closeReviewModal()" class="btn" style="margin-top: 20px;">Fermer le Rapport</button>
    </div>
</div>

<script>
    const questions = [
        {
            question: "Quelle est la fonction principale de la BATNA (Best Alternative To a Negotiated Agreement) ?",
            options: ["D√©finir votre objectif de prix id√©al", "√âvaluer le seuil de rupture de la n√©gociation", "Servir de point de d√©part aux concessions", "Identifier les besoins de l'autre partie"],
            answer: 1,
            explanation: "La BATNA d√©termine votre meilleure option en cas d'√©chec des n√©gociations. Elle fixe votre seuil de rupture et votre pouvoir r√©el."
        },
        {
            question: "Que repr√©sente la ZOPA (Zone of Possible Agreement) ?",
            options: ["La zone d'influence g√©ographique des parties", "L'√©cart entre le prix d'ouverture et le prix de fermeture", "La zone de chevauchement des objectifs acceptables", "L'ensemble des sujets abord√©s dans la n√©gociation"],
            answer: 2,
            explanation: "La ZOPA est la zone o√π les objectifs acceptables des deux parties se chevauchent, permettant un accord mutuellement satisfaisant."
        },
        {
            question: "Lors de la pr√©paration, quel type d'objectif est le plus important √† d√©finir ?",
            options: ["L'objectif plancher (le minimum acceptable)", "L'objectif id√©al (le maximum souhait√©)", "L'objectif cr√©dible (le r√©aliste)", "Les trois sont essentiels"],
            answer: 3,
            explanation: "Les trois niveaux d'objectifs (plancher, cr√©dible, id√©al) sont essentiels pour encadrer la n√©gociation."
        },
        {
            question: "Dans la phase d'Information, quel est l'objectif principal des questions ouvertes ?",
            options: ["Obtenir une r√©ponse par 'Oui' ou 'Non'", "Contr√¥ler la direction de l'entretien", "Encourager l'autre partie √† s'exprimer librement et √† d√©voiler ses besoins", "Valider un point pr√©cis rapidement"],
            answer: 2,
            explanation: "Les questions ouvertes permettent de d√©couvrir les motivations, priorit√©s et contraintes de l'interlocuteur."
        },
        {
            question: "Qu'est-ce que l'√©coute active ?",
            options: ["√âcouter sans interruption", "Reformuler, poser des questions de clarification et valider la compr√©hension", "Se concentrer uniquement sur les chiffres et les faits", "Pr√©parer mentalement sa prochaine r√©plique"],
            answer: 1,
            explanation: "L'√©coute active implique reformulation et validation pour montrer l'empathie et la bonne compr√©hension."
        },
        {
            question: "Comment doit-on g√©rer un silence pendant la phase d'Information ?",
            options: ["Le combler imm√©diatement", "Le consid√©rer comme un signe d'accord", "Le respecter, il pousse l'autre partie √† en dire plus", "Changer de sujet"],
            answer: 2,
            explanation: "Le silence bien g√©r√© incite souvent l'autre √† d√©voiler davantage ses besoins ou contraintes."
        },
        {
            question: "Comment √©tablit-on la confiance (phase Relation) rapidement avec l'autre partie ?",
            options: ["En parlant de soi et de ses r√©ussites", "En faisant preuve de transparence et en reconnaissant les points communs", "En faisant une concession majeure d√®s le d√©part", "En √©tant strictement factuel et distant"],
            answer: 1,
            explanation: "La confiance se b√¢tit par transparence, authenticit√© et points communs."
        },
        {
            question: "Quel r√¥le joue le langage corporel dans la phase Relation ?",
            options: ["Il est moins important que le discours", "Il repr√©sente environ 5% de la communication", "Il doit √™tre dominant", "Il transmet plus de 50% du message et r√©v√®le l'√©tat √©motionnel"],
            answer: 3,
            explanation: "Le non-verbal est cl√© dans la cr√©ation de la relation et du climat de confiance."
        },
        {
            question: "Que signifie 'isoler une objection' ?",
            options: ["Ignorer l'objection", "Demander s'il n'y a pas d'autres objections avant de la traiter", "R√©pondre imm√©diatement avec un argument fort", "Dire que l'objection est infond√©e"],
            answer: 1,
            explanation: "Isoler l'objection permet de v√©rifier que c'est bien le seul point de blocage."
        },
        {
            question: "Quel comportement est un signe de faible engagement de l'autre partie ?",
            options: ["Poser beaucoup de questions techniques", "H√©siter √† discuter des termes financiers", "√âvoquer souvent sa BATNA", "Exprimer de l'enthousiasme"],
            answer: 1,
            explanation: "La difficult√© √† parler d'argent ou d'engagement financier peut signaler un faible engagement."
        },
        {
            question: "Qu'est-ce que la technique d'ancrage dans la phase finale ?",
            options: ["Fixer un lieu de rencontre id√©al", "Proposer une premi√®re offre tr√®s favorable", "Proposer une offre extr√™me pour influencer la perception", "Attendre l'offre de l'autre"],
            answer: 2,
            explanation: "L'ancrage consiste √† poser une premi√®re offre ambitieuse pour influencer la zone de n√©gociation."
        },
        {
            question: "Comment pr√©senter une concession de mani√®re professionnelle ?",
            options: ["La donner discr√®tement", "La faire pr√©c√©der d'un 'Si... alors' (contrepartie)", "La faire passer pour une erreur corrig√©e", "La donner uniquement √† la fin"],
            answer: 1,
            explanation: "Une concession doit √™tre conditionnelle et valoris√©e."
        },
        {
            question: "Quel est le risque de faire des petites concessions successives ?",
            options: ["Satisfaction rapide", "Cr√©er un sentiment de p√©nurie", "Donner l'impression d'une marge illimit√©e", "Faciliter la relation"],
            answer: 2,
            explanation: "Des concessions successives donnent l'impression que vous pouvez toujours reculer."
        },
        {
            question: "Quelle est la meilleure technique de cl√¥ture si l'accord est proche mais h√©sitant ?",
            options: ["Ultimatum", "Cl√¥ture par l'alternative ('A ou B ?')", "Cl√¥ture par le silence", "Cl√¥ture par la menace"],
            answer: 1,
            explanation: "Proposer une alternative suppose que l'accord est act√© et facilite la d√©cision."
        }
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let timer;
    let timeLeft = 15;
    const timePerQuestion = 15;
    let quizStartTime;
    let quizEndTime;
    let userAnswers = [];

    const startScreen = document.getElementById("start-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const resultScreen = document.getElementById("result-screen");
    const questionText = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");
    const timeDisplay = document.getElementById("time");
    const finalScore = document.getElementById("final-score");
    const feedbackText = document.getElementById("feedback-text");
    const totalTimeDisplay = document.getElementById("total-time-display");
    const avgTimeDisplay = document.getElementById("avg-time-display");
    const reviewModal = document.getElementById("review-modal");
    const reviewContent = document.getElementById("review-content");
    const finishBtn = document.getElementById("finish-btn");

    function startQuiz() {
        startScreen.classList.remove("active");
        quizScreen.classList.add("active");
        resultScreen.classList.remove("active");
        finishBtn.style.display = "none";

        currentQuestionIndex = 0;
        score = 0;
        userAnswers = [];
        quizStartTime = new Date().getTime();

        loadQuestion();
    }

    function loadQuestion() {
        clearInterval(timer);
        timeLeft = timePerQuestion;
        timeDisplay.innerText = timeLeft;
        timeDisplay.parentElement.classList.remove('critical');
        startTimer();

        const currentQuestion = questions[currentQuestionIndex];
        questionText.innerText = currentQuestion.question;
        document.getElementById("current-question-num").innerText = currentQuestionIndex + 1;

        optionsContainer.innerHTML = "";
        currentQuestion.options.forEach((option, index) => {
            const button = document.createElement("button");
            button.innerText = option;
            button.classList.add("option-btn");
            button.onclick = () => selectAnswer(index);
            optionsContainer.appendChild(button);
        });
    }

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            timeDisplay.innerText = timeLeft;

            if(timeLeft <= 5) {
                timeDisplay.parentElement.classList.add('critical');
            }

            if (timeLeft <= 0) {
                clearInterval(timer);
                selectAnswer(-1);
            }
        }, 1000);
    }

    function selectAnswer(selectedIndex) {
        clearInterval(timer);
        const currentQuestion = questions[currentQuestionIndex];
        const buttons = optionsContainer.getElementsByClassName("option-btn");
        const timeSpent = timePerQuestion - (timeLeft > 0 ? timeLeft : 0);

        for (let btn of buttons) {
            btn.disabled = true;
            btn.style.opacity = "0.7";
        }

        if (selectedIndex === currentQuestion.answer) {
            buttons[selectedIndex].classList.add("correct");
            buttons[selectedIndex].style.opacity = "1";
            score++;
        } else {
            if (selectedIndex !== -1) {
                buttons[selectedIndex].classList.add("wrong");
            }
            buttons[currentQuestion.answer].classList.add("correct");
            buttons[currentQuestion.answer].style.opacity = "1";
        }

        userAnswers.push({
            question: currentQuestion.question,
            options: currentQuestion.options,
            selected: selectedIndex,
            correct: currentQuestion.answer,
            isCorrect: (selectedIndex === currentQuestion.answer),
            explanation: currentQuestion.explanation,
            timeSpent: timeSpent
        });

        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                endQuiz();
            }
        }, 1500);
    }

    function endQuiz() {
        quizScreen.classList.remove("active");
        resultScreen.classList.add("active");
        quizEndTime = new Date().getTime();

        const totalTime = ((quizEndTime - quizStartTime) / 1000).toFixed(1);
        const avgTime = (totalTime / questions.length).toFixed(1);

        finalScore.innerText = score;
        totalTimeDisplay.innerText = totalTime + 's';
        avgTimeDisplay.innerText = avgTime + 's';

        generateFeedback(score);
        // ‚ûú On affiche le bouton Terminer quand le quiz est fini
        finishBtn.style.display = "inline-block";
    }

    function generateFeedback(currentScore) {
        let message = "";
        let color = "";

        if (currentScore === 15) {
            message = "üëë Expert en N√©gociation ! Votre ma√Ætrise de la d√©marche NIRN est parfaite.";
            color = "#27ae60";
        } else if (currentScore >= 11) {
            message = "‚≠ê Ma√Ætrise Forte ! Vous avez une excellente compr√©hension des fondamentaux.";
            color = "#2ecc71";
        } else if (currentScore >= 6) {
            message = "üíº Bases Acquises. Continuez √† travailler les techniques sp√©cifiques.";
            color = "#f39c12";
        } else {
            message = "üß≠ Piste de Progr√®s. Le rapport de correction est votre meilleur outil !";
            color = "#e74c3c";
        }

        feedbackText.innerText = message;
        feedbackText.style.borderColor = color;
    }

    function showReviewModal() {
        reviewModal.style.display = 'flex';
        reviewContent.innerHTML = '';

        userAnswers.forEach((item, index) => {
            const reviewItem = document.createElement("div");
            reviewItem.classList.add(
                "review-item",
                item.isCorrect ? "correct-answer" : "wrong-answer"
            );

            const result = item.isCorrect ? "‚úÖ Correct" : "‚ùå Incorrect";
            const userChoiceText = item.selected !== -1 ? item.options[item.selected] : "Aucune r√©ponse (Temps √©coul√©)";
            const correctAnswerText = item.options[item.correct];
            const resultColor = item.isCorrect ? 'var(--success-color)' : 'var(--error-color)';

            reviewItem.innerHTML = `
                <h4>Question ${index + 1} : ${item.question}</h4>
                <p>R√©sultat : <span style="color:${resultColor}; font-weight:700;">${result}</span> (Temps : ${item.timeSpent}s)</p>
                <p>Votre choix : ${userChoiceText} ${!item.isCorrect && item.selected !== -1 ? `<span style="color: var(--error-color);">(Faux)</span>` : ''}</p>
                <p>R√©ponse correcte : ${correctAnswerText}</p>
                <div class="explanation-box">
                    L'explication : ${item.explanation}
                </div>
            `;
            reviewContent.appendChild(reviewItem);
        });
    }

    function closeReviewModal(event) {
        if (event === undefined || event.target.id === 'review-modal') {
            reviewModal.style.display = 'none';
        }
    }

    function restartQuiz() {
        resultScreen.classList.remove("active");
        startScreen.classList.add("active");
        reviewModal.style.display = 'none';
        finishBtn.style.display = "none";
    }

    // ‚ûú Quand on termine : on marque la progression + retour √† la map
    function finishAndReturn() {
        // On marque dans le localStorage que tous les niveaux sont compl√©t√©s
        localStorage.setItem('nird_all_completed', 'true');
        // On retourne √† la map (salle6.html est dans /salles)
        window.location.href = '../map.html';
    }
</script>
</body>
</html>
