<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Salle 2 ‚Äî Choisis ton OS id√©al</title>

    <!-- Police arcade / pixel -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <!-- Feuille de style -->
    <link rel="stylesheet" href="../css/salle2.css">
</head>
<body>
<div class="game-wrapper">

    <!-- BOUTON RETOUR -->
    <a href="../map.html" class="back-btn">‚Üê Retour √† la map</a>

    <div class="header">
        <h1>Salle 2 ‚Äî Passer de Windows √† Linux</h1>
        <h2>Mini-jeu : ‚ÄúChoisis ton OS id√©al‚Äù üß™</h2>
        <p>Glisse chaque caract√©ristique dans le bon OS : Windows, macOS ou Linux.</p>
    </div>

    <div class="layout">

        <!-- OS Cards -->
        <div class="os-cards">

            <!-- Windows -->
            <div class="os-card">
                <div class="os-tag">Windows</div>
                <h3>Windows</h3>
                <ul>
                    <li>Tr√®s r√©pandu sur les PC</li>
                    <li>Beaucoup de logiciels propri√©taires</li>
                    <li>Tr√®s utilis√© pour les jeux vid√©o</li>
                </ul>
                <div id="windows-drop" class="drop-zone empty" data-os="windows" data-label="Caract√©ristiques de Windows ici"></div>
            </div>

            <!-- macOS -->
            <div class="os-card">
                <div class="os-tag">macOS</div>
                <h3>macOS</h3>
                <ul>
                    <li>Uniquement sur les Mac</li>
                    <li>√âcosyst√®me Apple tr√®s int√©gr√©</li>
                    <li>Mat√©riel premium et co√ªteux</li>
                </ul>
                <div id="mac-drop" class="drop-zone empty" data-os="mac" data-label="Caract√©ristiques de macOS ici"></div>
            </div>

            <!-- Linux -->
            <div class="os-card linux">
                <span class="linux-badge">Objectif sobri√©t√© üéØ</span>
                <div class="os-tag">Linux</div>
                <h3>Linux</h3>
                <ul>
                    <li>Id√©al pour la sobri√©t√© num√©rique</li>
                </ul>
                <div id="linux-drop" class="drop-zone empty" data-os="linux" data-label="Caract√©ristiques de Linux ici"></div>
            </div>
        </div>

        <!-- Tokens -->
        <aside class="side-panel">
            <h4>Caract√©ristiques √† placer üß©</h4>
            <p style="font-size:0.6rem; line-height:1.4;">
                Glisse chaque jeton dans l‚ÄôOS qui lui correspond.<br>
                Tu peux corriger autant que tu veux avant V√©rifier.
            </p>

            <div id="token-pool" class="token-pool">

                <!-- Linux -->
                <div class="token" draggable="true" data-target="linux">Gratuit ou faible co√ªt</div>
                <div class="token" draggable="true" data-target="linux">Libre & open-source</div>
                <div class="token" draggable="true" data-target="linux">Fonctionne sur vieux mat√©riel</div>
                <div class="token" draggable="true" data-target="linux">Tr√®s personnalisable</div>
                <div class="token" draggable="true" data-target="linux">Respect de la vie priv√©e</div>

                <!-- Windows -->
                <div class="token" draggable="true" data-target="windows">Licence propri√©taire payante</div>
                <div class="token" draggable="true" data-target="windows">Tr√®s utilis√© pour les jeux vid√©o</div>
                <div class="token" draggable="true" data-target="windows">Souvent install√© par d√©faut</div>
                <div class="token" draggable="true" data-target="windows">Mises √† jour impos√©es</div>

                <!-- macOS -->
                <div class="token" draggable="true" data-target="mac">R√©serv√© au mat√©riel Apple</div>
                <div class="token" draggable="true" data-target="mac">√âcosyst√®me Apple int√©gr√©</div>
                <div class="token" draggable="true" data-target="mac">Image premium</div>
                <div class="token" draggable="true" data-target="mac">Mat√©riel plus cher</div>

            </div>
        </aside>
    </div>

    <div class="controls">
        <button id="check-btn" class="btn-primary">‚úî V√©rifier</button>
        <button id="reset-btn" class="btn-secondary">üîÅ Reset</button>

        <!-- BOUTON SUIVANT (cach√© au d√©but) -->
        <button id="next-btn" class="btn-next" style="display:none;">
            Suivant ‚Üí Salle 3
        </button>

        <div id="feedback" class="feedback">Place les caract√©ristiques puis clique sur V√©rifier.</div>
    </div>
</div>

<script>
    const tokens = document.querySelectorAll('.token');
    const dropZones = document.querySelectorAll('.drop-zone');
    const tokenPool = document.getElementById('token-pool');
    const checkBtn = document.getElementById('check-btn');
    const resetBtn = document.getElementById('reset-btn');
    const nextBtn = document.getElementById('next-btn');
    const feedback = document.getElementById('feedback');

    let draggedToken = null;

    // Drag & Drop
    tokens.forEach(token => {
        token.addEventListener('dragstart', () => draggedToken = token);
        token.addEventListener('dragend', () => draggedToken = null);
    });

    function makeDroppable(zone) {
        zone.addEventListener('dragover', e => e.preventDefault());
        zone.addEventListener('drop', () => {
            if (!draggedToken) return;
            zone.appendChild(draggedToken);
            updateEmptyStates();
            clearHighlights();
        });
    }

    dropZones.forEach(makeDroppable);
    makeDroppable(tokenPool);

    function updateEmptyStates() {
        dropZones.forEach(zone => {
            zone.classList.toggle('empty', zone.querySelector('.token') === null);
        });
    }

    function clearHighlights() {
        tokens.forEach(t => t.classList.remove('correct-highlight', 'wrong-highlight'));
        dropZones.forEach(z => z.classList.remove('valid', 'invalid'));
    }

    // V√©rification
    checkBtn.addEventListener('click', () => {
        clearHighlights();

        let correct = 0;
        let wrong = 0;
        const total = tokens.length;

        tokens.forEach(token => {
            const target = token.dataset.target;
            const zone = token.parentElement;
            if (zone.classList.contains('drop-zone')) {
                if (zone.dataset.os === target) {
                    correct++;
                    token.classList.add('correct-highlight');
                } else {
                    wrong++;
                    token.classList.add('wrong-highlight');
                }
            }
        });

        const placed = correct + wrong;
        const unplaced = total - placed;

        if (correct === total && wrong === 0) {
            feedback.textContent = "Parfait ! Salle valid√©e üéâüêß";
            feedback.className = "feedback success";

            dropZones.forEach(z => z.classList.add('valid'));

            // AFFICHER LE BOUTON SUIVANT
            nextBtn.style.display = "inline-block";

        } else {
            feedback.textContent =
                `${correct}/${total} corrects ‚Äì ${wrong} erreurs ‚Äì ${unplaced} non plac√©s.`;
            feedback.className = "feedback error";

            if (wrong > 0) dropZones.forEach(z => z.classList.add('invalid'));
        }
    });

    // Reset
    resetBtn.addEventListener('click', () => {
        tokens.forEach(token => tokenPool.appendChild(token));
        updateEmptyStates();
        clearHighlights();
        nextBtn.style.display = "none"; // cacher le bouton suivant
        feedback.textContent = "Place les caract√©ristiques puis clique sur V√©rifier.";
        feedback.className = "feedback";
    });

    // Redirection vers salle 3
    nextBtn.addEventListener('click', () => {
        window.location.href = "../salles/salle3.html";
    });

    updateEmptyStates();
</script>

</body>
</html>
